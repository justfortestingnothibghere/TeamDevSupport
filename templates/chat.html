{% extends "base.html" %}
{% block content %}
<div id="sidebar">
    <h1>Built-in-Group</h1>
    <ul>
        {% for g in groups %}
        <li><a href="{{ url_for('chat', group_id=g.id) }}">{{ g.name }} {% if g.verified %}<img src="/static/icons/verified.svg" class="verified">{% endif %}</a></li>
        {% endfor %}
    </ul>
    {% if current_user.is_admin %}<a href="/admin" style="color:gold;">âš¡ Admin Panel</a><br>{% endif %}
    <a href="{{ url_for('logout') }}">Logout</a>
</div>
<div id="chat-area">
    <h2>{{ group.name }} {% if group.verified %}<img src="/static/icons/verified.svg" class="verified">{% endif %}</h2>
    <p>{{ group.tagline or group.description }}</p>
    <div id="messages">
        {% for msg in messages %}
            {{ render_message(msg) | safe }}
        {% endfor %}
    </div>
    <div id="input-area">
        <form id="msg-form" enctype="multipart/form-data">
            <input type="text" id="message-input" placeholder="Send a message..." autocomplete="off">
            <input type="file" id="file-input" style="display:none;">
            <label for="file-input" style="cursor:pointer;">ðŸ“Ž</label>
            <button type="submit">Send</button>
        </form>
    </div>
</div>
<script>
const groupId = {{ group.id }};
const source = new EventSource(`/stream/${groupId}`);
source.onmessage = e => document.getElementById('messages').insertAdjacentHTML('beforeend', e.data);
document.getElementById('msg-form').onsubmit = async e => {
    e.preventDefault();
    const form = new FormData();
    form.append('content', document.getElementById('message-input').value);
    const file = document.getElementById('file-input').files[0];
    if (file) form.append('file', file);
    await fetch(`/send/${groupId}`, {method:'POST', body:form});
    document.getElementById('message-input').value = '';
    document.getElementById('file-input').value = '';
};
</script>
{% endblock %}
